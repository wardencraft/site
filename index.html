<!--

-->

<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="icons/favicon.svg" type="image/svg+xml">
</head>
<body>
    <main>
        <section class="container">
            <h1>NEXUS</h1>
        </section>
        <section class="container">
            <div id="engine"></div>
            <input type="text" placeholder=">_" id="input" autocomplete="off">
        </section>
        <section id="output">a</section>
    </main>
    <script>
        const input = document.getElementById("input");
        const engine_html = document.getElementById("engine")
        const output = document.getElementById("output");

        
        //Abre os Shortcuts do shortcuts.json
        let shortcuts = {};
        async function loadShortcuts() {
            const res = await fetch("shortcuts.json");
            shortcuts = await res.json();
        }
        loadShortcuts();



        function showOutput() {
            output.style.display = "block";
        }

        //Funções para rodar via shortcuts
        const scripts = {
            'ls':  () => {
                    showOutput();
                    let html = "Comandos Disponiveis:<br><br>";
                    for(let cmd in shortcuts) {
                        html += `${cmd} - ${shortcuts[cmd].description}<br>`
                    }
                    output.innerHTML = html;
                    input.value = '';
                },
            'cls': () => {
                output.style.display = "none";
                input.value = "";
            }
        }

        //Redirecionamento de páginas / funções via input
        search_tool = (text, link) => {
            const short = shortcuts[text];
            if(short){
                if(short.type==="url") {
                window.location.href = short.value;
            } else if(short.type==="script") {
                scripts[text]();
            }
            } else if(text.includes('https://') || text.includes('http://')) {
                window.location.href = text;
            } else if(text.includes('.') && !text.includes(' ')) {
                window.location.href = `https://${text}`
            } else {
                window.location.href = (`${link}${encodeURIComponent(text)}`);
            }
        }

        //Lista das search engines disponiveis.
        engine = (number) => {
            engine_html.classList.remove('google', 'youtube', 'chat');
            if(number==1) {
                engine_html.innerHTML = "<img src='icons/google.svg' id='engine-icon'>";
                link = 'https://www.google.com/search?q=';
                engine_html.classList.add('google');
            } else if(number==2) {
                engine_html.innerHTML = "<img src='icons/youtube.svg' id='engine-icon'>";
                link = 'https://www.youtube.com/results?search_query=';
                engine_html.classList.add('youtube');
            } else if(number==3) {
                engine_html.innerHTML = "<img src='icons/chatgpt.svg' id='engine-icon'>";
                link = 'https://chat.openai.com/?q='
                engine_html.classList.add('chat');
            }
        }

        engine(1);

        input.focus();

        //Hotkey para pesquisar
        input.addEventListener("keydown", (e) => {
            if(e.key === 'Enter') {
                let text = input.value.toLowerCase();
                search_tool(text, link);
            }
        })

        //Hotkeys para alterar engines
        window.addEventListener("keydown", (e) => {
            if(e.ctrlKey && e.key === ' '){
                e.preventDefault();
                input.focus();
            } else if(e.altKey && e.key === '1'){ //Google
                e.preventDefault();
                engine(1);
            } else if(e.altKey && e.key === '2'){ //Youtube
                e.preventDefault();
                engine(2);
            } else if(e.altKey && e.key === '3'){ //ChatGPT
                e.preventDefault();
                engine(3);
            }
        })

    </script>
</body>

</html>
